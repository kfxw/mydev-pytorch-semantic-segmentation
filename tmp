TODO
dataloader-val&test loader
arg
eval


import os
import time
import random
import argparse
from distutils.version import LooseVersion
import torch
import torch.nn as nn
from data.voc.VOCDataset import VOCTrainDataset
from networks import VGGModelBuilder, ResNetModelBuilder, SegmentationModule
from utils import AverageMeter
from lib.nn import UserScatteredDataParallel, user_scattered_collate, patch_replication_callback
import lib.utils.data as torchdata
import matplotlib.pyplot as plt
import numpy as np

class opt():
	def __init__(self):
		self.root_dataset = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012'
		self.cropSize = 512	# 512,328
		self.random_flip = True
		self.random_scale = True
		self.random_scale_factor_max = 1.2
		self.random_scale_factor_min = 0.75
		self.train_list_file = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012/ImageSets/Segmentation/deeplab_trainval_aug.txt'
		self.val_list_file = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012/ImageSets/Segmentation/deeplab_val.txt'
		self.test_list_file = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012/ImageSets/Segmentation/deeplab_val.txt'

arg = opt()
dataset_train = VOCTrainDataset(arg, batch_per_gpu = 4)
loader_train = torchdata.DataLoader(dataset_train, batch_size=4, shuffle=False, collate_fn=user_scattered_collate, num_workers=1, drop_last=True, pin_memory=True)
iterator_train = iter(loader_train)
batch_data = next(iterator_train)
img = batch_data[0]['data'].cpu().numpy()
plt.imshow(img[1,::-1,:,:].transpose(1,2,0)/255.0+0.5)
plt.show()

seg = batch_data[0]['seg_label'].cpu().numpy()
plt.imshow(seg[1,:,:])
plt.show()

plt.imshow(img[0,0,:,:])

###########################	for val data loader
import os
import time
import random
import argparse
from distutils.version import LooseVersion
import torch
import torch.nn as nn
from data.voc.VOCDataset import VOCTrainDataset
from networks import VGGModelBuilder, ResNetModelBuilder, SegmentationModule
from utils import AverageMeter
from lib.nn import UserScatteredDataParallel, user_scattered_collate, patch_replication_callback
import lib.utils.data as torchdata
import matplotlib.pyplot as plt
import numpy as np

class opt():
	def __init__(self):
		self.root_dataset = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012'
		self.cropSize = 512	# 512,328
		self.random_flip = True
		self.random_scale = True
		self.random_scale_factor_max = 1.2
		self.random_scale_factor_min = 0.75
		self.train_list_file = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012/ImageSets/Segmentation/deeplab_trainval_aug.txt'
		self.val_list_file = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012/ImageSets/Segmentation/deeplab_val.txt'
		self.test_list_file = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012/ImageSets/Segmentation/deeplab_val.txt'

arg = opt()
dataset_val = VOCValDataset(arg, val_batch_size = 4)
loader_val = torchdata.DataLoader(dataset_val, batch_size=4, shuffle=False, collate_fn=user_scattered_collate, num_workers=1, drop_last=False, pin_memory=True)
iterator_val = iter(loader_val)
batch_data = next(iterator_val)
img = batch_data[0]['data'].cpu().numpy()
plt.imshow(img[1,::-1,:,:].transpose(1,2,0)/255.0+0.5)
plt.show()

seg = batch_data[0]['seg_label'].cpu().numpy()
plt.imshow(seg[1,:,:])
plt.show()

###########################	for test data loader
import os
import time
import random
import argparse
from distutils.version import LooseVersion
import torch
import torch.nn as nn
from data.voc.VOCDataset import VOCTrainDataset
from networks import VGGModelBuilder, ResNetModelBuilder, SegmentationModule
from utils import AverageMeter
from lib.nn import UserScatteredDataParallel, user_scattered_collate, patch_replication_callback
import lib.utils.data as torchdata
import matplotlib.pyplot as plt
import numpy as np

class opt():
	def __init__(self):
		self.root_dataset = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012'
		self.cropSize = 512	# 512,328
		self.random_flip = True
		self.random_scale = True
		self.random_scale_factor_max = 1.2
		self.random_scale_factor_min = 0.75
		self.train_list_file = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012/ImageSets/Segmentation/deeplab_trainval_aug.txt'
		self.val_list_file = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012/ImageSets/Segmentation/deeplab_val.txt'
		self.test_list_file = '/home/kfxw/Development/data/VOC/VOC2012-May-11-data/VOCdevkit/VOC2012/ImageSets/Segmentation/deeplab_val.txt'

arg = opt()
dataset_test = VOCTestDataset(arg)
loader_test = torchdata.DataLoader(dataset_test, batch_size=1, shuffle=False, collate_fn=user_scattered_collate, num_workers=1, drop_last=False, pin_memory=True)
iterator_test = iter(loader_test)
batch_data = next(iterator_test)
img = batch_data[0]['data'].cpu().numpy()
plt.imshow(img[1,::-1,:,:].transpose(1,2,0)/255.0+0.5)
plt.show()

########################## for cfg file
solver_cfg_name = "test_solver_cfg.py"
solver_cfg_name = solver_cfg_name.strip().split('.')[-2]
exec('from '+solver_cfg_name+' import opt')
args = opt()
print("Input arguments:")
for key, val in vars(args).items():
	print("{:16} {}".format(key, val))
